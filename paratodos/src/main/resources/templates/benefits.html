<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Benef√≠cios - Sistema RH</title>
  <link rel="stylesheet" href="public/styles/global.css">
  <link rel="stylesheet" href="public/styles/dashboard.css">
  <link rel="stylesheet" href="public/styles/components.css">
</head>

<body>
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <img src="public/assets/gruporhpaint.png" alt="logo_menu_lateral" height="60">
      </div>
    </div>
    <nav class="sidebar-nav">
      <a href="dashboard.html" class="nav-item"><span class="nav-text">Dashboard</span></a>
      <div class="nav-section">Gest√£o de Pessoas</div>
      <a href="employees.html" class="nav-item"><span class="nav-text">Funcion√°rios</span></a>
      <a href="departments.html" class="nav-item"><span class="nav-text">Departamentos</span></a>
      <a href="positions.html" class="nav-item"><span class="nav-text">Cargos</span></a>
      <div class="nav-section">Recursos Humanos</div>
      <a href="recruitment.html" class="nav-item"><span class="nav-text">Recrutamento</span></a>
      <a href="training.html" class="nav-item"><span class="nav-text">Treinamentos</span></a>
      <a href="performance.html" class="nav-item"><span class="nav-text">Avalia√ß√µes</span></a>
      <div class="nav-section">Departamento Pessoal</div>
      <a href="payroll.html" class="nav-item"><span class="nav-text">Folha de Pagamento</span></a>
      <a href="benefits.html" class="nav-item active"><span class="nav-text">Benef√≠cios</span></a>
      <a href="vacation.html" class="nav-item"><span class="nav-text">F√©rias</span></a>
      <a href="timesheet.html" class="nav-item"><span class="nav-text">Ponto</span></a>
      <div class="nav-section">Administra√ß√£o</div>
      <a href="reports.html" class="nav-item"><span class="nav-text">Relat√≥rios</span></a>
      <a href="settings.html" class="nav-item"><span class="nav-text">Configura√ß√µes</span></a>
    </nav>
  </aside>

  <div class="main-content">
    <header class="topbar">
      <div class="topbar-left">
        <button class="mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
        <h1>Benef√≠cios</h1>
      </div>
      <div class="topbar-right">
        <div class="user-menu">
          <button class="user-button" id="userMenuButton">
            <span class="user-avatar" id="userAvatar">U</span>
            <span class="user-name" id="userName">Usu√°rio</span>
            <span class="user-arrow">‚ñº</span>
          </button>
          <div class="user-dropdown" id="userDropdown">
            <div class="user-info">
              <strong id="userFullName">Nome do Usu√°rio</strong>
              <small id="userProfile">Perfil</small>
            </div>
            <hr>
            <a href="#" class="dropdown-item">Meu Perfil</a>
            <a href="settings.html" class="dropdown-item">Configura√ß√µes</a>
            <hr>
            <a href="#" class="dropdown-item" id="logoutButton">Sair</a>
          </div>
        </div>
      </div>
    </header>

    <div class="content-area">
      <div class="stats-row">
        <div class="stat-box">
          <div class="stat-box-icon" style="background: rgba(44, 62, 80, 0.1);"><img
              src="public/assets/gift (2).png" alt="icone_tipos_beneficios"></div>
          <div class="stat-box-value">6</div>
          <div class="stat-box-label">Tipos de Benef√≠cios</div>
        </div>
        <div class="stat-box">
          <div class="stat-box-icon" style="background: rgba(39, 174, 96, 0.1);"><img
              src="public/assets/users (1).png" alt="icone_beneficiarios"></div>
          <div class="stat-box-value">248</div>
          <div class="stat-box-label">Benefici√°rios</div>
        </div>
        <div class="stat-box">
          <div class="stat-box-icon" style="background: rgba(243, 156, 18, 0.1);"><img
              src="public/assets/banknote (1).png" alt="icone_custo_mensal"></div>
          <div class="stat-box-value">R$ 185K</div>
          <div class="stat-box-label">Custo Mensal</div>
        </div>
        <div class="stat-box">
          <div class="stat-box-icon" style="background: rgba(231, 76, 60, 0.1);"><img
              src="public/assets/chart-column (1).png" alt="icone_custo_funcionario"></div>
          <div class="stat-box-value">R$ 745</div>
          <div class="stat-box-label">Custo/Funcion√°rio</div>
        </div>
      </div>

      <div class="page-header">
        <div>
          <h2 class="page-title">Gest√£o de Benef√≠cios</h2>
          <p class="page-subtitle">Configure e gerencie os benef√≠cios oferecidos</p>
        </div>
        <div class="page-actions"><button class="btn btn-primary" onclick="openModal()">+ Novo Benef√≠cio</button></div>
      </div>

      <div class="departments-grid" id="benefitsGrid"></div>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="modal-dialog modal-md">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Novo Benef√≠cio</h3><button class="modal-close"
          onclick="Modal.close('modal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form">
          <input type="hidden" name="id">
          <div class="form-group"><label class="form-label">Nome do Benef√≠cio *</label><input type="text"
              class="form-input" name="nome" required></div>
          <div class="form-group"><label class="form-label">Descri√ß√£o</label><textarea class="form-input"
              name="descricao" rows="2"></textarea></div>
          <div class="form-row form-row-2">
            <div class="form-group"><label class="form-label">Valor Padr√£o</label><input type="text" class="form-input"
                name="valor" data-mask="currency"></div>
            <div class="form-group"><label class="form-label">Desconto em Folha?</label><select class="form-select"
                name="desconto">
                <option value="true">Sim</option>
                <option value="false">N√£o</option>
              </select></div>
          </div>
          <div class="form-group"><label class="checkbox-label"><input type="checkbox" name="ativo"
                checked><span>Benef√≠cio Ativo</span></label></div>
        </form>
      </div>
      <div class="modal-footer"><button class="btn btn-secondary"
          onclick="Modal.close('modal')">Cancelar</button><button class="btn btn-primary"
          onclick="save()">Salvar</button></div>
    </div>
  </div>

  <style>
    .departments-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--spacing-4)
    }

    .benefit-card {
      background: white;
      border-radius: var(--radius-lg);
      padding: var(--spacing-5);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--gray-200)
    }

    .benefit-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--spacing-3)
    }

    .benefit-icon {
      width: 48px;
      height: 48px;
      background: var(--gray-100);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px
    }

    .benefit-name {
      font-size: var(--font-size-lg);
      font-weight: 600;
      margin-bottom: var(--spacing-1)
    }

    .benefit-desc {
      font-size: var(--font-size-sm);
      color: var(--gray-500);
      margin-bottom: var(--spacing-3)
    }

    .benefit-stats {
      display: flex;
      justify-content: space-between;
      padding-top: var(--spacing-3);
      border-top: 1px solid var(--gray-100);
      font-size: var(--font-size-sm)
    }
  </style>

  <script src="public/scripts/auth.js"></script>
  <script src="public/scripts/components.js"></script>
  <script>
    const benefits = [
      { id: 1, nome: "Vale Refei√ß√£o", descricao: "Cart√£o para refei√ß√µes di√°rias", valor: 800, beneficiarios: 235, ativo: true },
      { id: 2, nome: "Vale Transporte", descricao: "Aux√≠lio para deslocamento", valor: 300, beneficiarios: 180, ativo: true },
      { id: 3, nome: "Plano de Sa√∫de", descricao: "Assist√™ncia m√©dica completa", valor: 650, beneficiarios: 248, ativo: true },
      { id: 4, nome: "Plano Odontol√≥gico", descricao: "Cobertura odontol√≥gica", valor: 80, beneficiarios: 220, ativo: true },
      { id: 5, nome: "Seguro de Vida", descricao: "Prote√ß√£o para fam√≠lia", valor: 50, beneficiarios: 248, ativo: true },
      { id: 6, nome: "Gympass", descricao: "Acesso a academias parceiras", valor: 100, beneficiarios: 85, ativo: true }
    ];
    let currentId = null;

    document.addEventListener('DOMContentLoaded', () => {
      if (!Auth.requireAuth()) return;

      // Inicializar interface
      initUserMenu();
      initSidebar();
      render();
      Mask.initAll();
    });

    function initUserMenu() {
      const user = Auth.getCurrentUser();
      if (user) {
        const firstName = (user.email || user.username).split('@')[0].split('.')[0];
        const capitalizedName = firstName.charAt(0).toUpperCase() + firstName.slice(1);

        document.getElementById('userName').textContent = capitalizedName;
        document.getElementById('userFullName').textContent = user.email || user.username;
        document.getElementById('userProfile').textContent = user.profileName || user.profile;
        document.getElementById('userAvatar').textContent = capitalizedName[0].toUpperCase();
      }

      document.getElementById('userMenuButton').addEventListener('click', () => {
        document.getElementById('userDropdown').classList.toggle('active');
      });

      document.getElementById('logoutButton').addEventListener('click', (e) => {
        e.preventDefault();
        Auth.logout();
      });

      document.addEventListener('click', (e) => {
        if (!e.target.closest('.user-menu')) {
          document.getElementById('userDropdown').classList.remove('active');
        }
      });
    }

    function initSidebar() {
      const sidebar = document.getElementById('sidebar');
      const mobileBtn = document.getElementById('mobileMenuBtn');

      mobileBtn?.addEventListener('click', () => {
        sidebar.classList.toggle('mobile-open');
      });

      document.addEventListener('click', (e) => {
        if (window.innerWidth <= 768) {
          if (!e.target.closest('.sidebar') && !e.target.closest('.mobile-menu-btn')) {
            sidebar.classList.remove('mobile-open');
          }
        }
      });
    }

    function render() {
      document.getElementById("benefitsGrid").innerHTML = benefits.map(b => `
        <div class="benefit-card">
          <div class="benefit-header">
            <div class="cell-actions">
              <button class="btn-icon edit" onclick="edit(${b.id})"><img src="public/assets/pencil (1).png" alt="icone_editar"></button>
              <button class="btn-icon delete" onclick="remove(${b.id})"><img src="public/assets/trash-2 (1).png" alt="icone_excluir"></button>
            </div>
          </div>
          <h3 class="benefit-name">${b.nome}</h3>
          <p class="benefit-desc">${b.descricao}</p>
          <div class="benefit-stats">
            <span><strong>${b.beneficiarios}</strong> benefici√°rios</span>
            <span><strong>${formatCurrency(b.valor)}</strong>/m√™s</span>
          </div>
        </div>
      `).join('');
    }

    function openModal(id = null) {
      currentId = id;
      document.getElementById("form").reset();
      document.getElementById("modalTitle").textContent = id ? "Editar Benef√≠cio" : "Novo Benef√≠cio";
      if (id) { const item = benefits.find(b => b.id === id); if (item) Form.populate('form', item); }
      Modal.open('modal'); Mask.initAll();
    }

    function edit(id) { openModal(id); }
    function save() { const data = Form.serialize('form'); if (!data.nome) { Toast.error('Nome obrigat√≥rio'); return; } if (currentId) { const idx = benefits.findIndex(b => b.id === currentId); if (idx > -1) benefits[idx] = { ...benefits[idx], ...data }; Toast.success('Benef√≠cio atualizado!'); } else { benefits.push({ id: Date.now(), ...data, beneficiarios: 0, icon: 'üéÅ' }); Toast.success('Benef√≠cio criado!'); } Modal.close('modal'); render(); }
    function remove(id) { Confirm.show('Excluir este benef√≠cio?', () => { const idx = benefits.findIndex(b => b.id === id); if (idx > -1) benefits.splice(idx, 1); Toast.success('Benef√≠cio exclu√≠do!'); render(); }); }
    function formatCurrency(val) { return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(val || 0); }
  </script>
  <script src="public/scripts/dashboard.js"></script>
</body>

</html>