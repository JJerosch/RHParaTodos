<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- Fragment: Topbar completa -->
<header th:fragment="topbar" class="topbar" id="topbar">
    
    <!-- Left Section -->
    <div class="topbar-left">
        <!-- Mobile Menu Toggle -->
        <button type="button" class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Menu">
            <img th:src="@{/images/icons/menu.png}" alt="" class="icon">
        </button>
        
        <!-- Breadcrumb -->
        <nav class="breadcrumb" aria-label="Breadcrumb" th:if="${breadcrumbs}">
            <ol class="breadcrumb-list">
                <li class="breadcrumb-item">
                    <a th:href="@{/dashboard}" class="breadcrumb-link">
                        <img th:src="@{/images/icons/home.png}" alt="Home" class="icon icon-sm">
                    </a>
                </li>
                <th:block th:each="crumb, iterStat : ${breadcrumbs}">
                    <li class="breadcrumb-separator">
                        <img th:src="@{/images/icons/chevron-right.png}" alt="" class="icon icon-xs">
                    </li>
                    <li class="breadcrumb-item" th:classappend="${iterStat.last} ? 'active' : ''">
                        <a th:href="${crumb.url}" 
                           th:text="${crumb.label}"
                           th:if="${!iterStat.last}"
                           class="breadcrumb-link">Item</a>
                        <span th:text="${crumb.label}" 
                              th:if="${iterStat.last}"
                              class="breadcrumb-current">Item Atual</span>
                    </li>
                </th:block>
            </ol>
        </nav>
        
        <!-- Page Title (quando não há breadcrumbs) -->
        <h1 class="page-title" th:if="${!breadcrumbs}" th:text="${pageTitle}">Título da Página</h1>
    </div>
    
    <!-- Right Section -->
    <div class="topbar-right">
        
        <!-- Search -->
        <div class="topbar-search">
            <form th:action="@{/busca}" method="get" class="search-form">
                <div class="search-input-wrapper">
                    <img th:src="@{/images/icons/search.png}" alt="" class="icon search-icon">
                    <input type="search" 
                           name="q" 
                           class="search-input" 
                           placeholder="Buscar..."
                           autocomplete="off">
                    <kbd class="search-shortcut">Ctrl+K</kbd>
                </div>
            </form>
        </div>
        
        <!-- Quick Actions -->
        <div class="topbar-actions">
            
            <!-- Theme Toggle -->
            <button type="button" class="action-btn" id="themeToggle" title="Alternar tema">
                <img th:src="@{/images/icons/sun.png}" alt="Tema claro" class="icon theme-icon-light">
                <img th:src="@{/images/icons/moon.png}" alt="Tema escuro" class="icon theme-icon-dark">
            </button>
            
            <!-- Notifications -->
            <div class="action-dropdown" id="notificationsDropdown">
                <button type="button" class="action-btn notification-btn" data-dropdown-toggle="notifications">
                    <img th:src="@{/images/icons/bell.png}" alt="Notificações" class="icon">
                    <span class="notification-badge" 
                          th:if="${notificationCount > 0}" 
                          th:text="${notificationCount > 99 ? '99+' : notificationCount}">5</span>
                </button>
                <div class="dropdown-menu dropdown-notifications" id="notifications">
                    <div class="dropdown-header">
                        <h3 class="dropdown-title">Notificações</h3>
                        <a th:href="@{/notificacoes/marcar-todas-lidas}" class="dropdown-action">Marcar todas como lidas</a>
                    </div>
                    <div class="dropdown-body">
                        <ul class="notification-list" th:if="${notifications != null && !notifications.empty}">
                            <li th:each="notif : ${notifications}" 
                                class="notification-item"
                                th:classappend="${!notif.lida} ? 'unread' : ''">
                                <a th:href="${notif.url}" class="notification-link">
                                    <div class="notification-icon">
                                        <img th:src="@{'/images/icons/' + ${notif.icone} + '.png'}" alt="" class="icon">
                                    </div>
                                    <div class="notification-content">
                                        <p class="notification-text" th:text="${notif.mensagem}">Mensagem da notificação</p>
                                        <span class="notification-time" th:text="${notif.tempoRelativo}">Há 5 minutos</span>
                                    </div>
                                </a>
                            </li>
                        </ul>
                        <div class="dropdown-empty" th:if="${notifications == null || notifications.empty}">
                            <img th:src="@{/images/icons/inbox-empty.png}" alt="" class="icon icon-lg">
                            <p>Nenhuma notificação</p>
                        </div>
                    </div>
                    <div class="dropdown-footer">
                        <a th:href="@{/notificacoes}" class="dropdown-footer-link">Ver todas as notificações</a>
                    </div>
                </div>
            </div>
            
            <!-- Messages -->
            <div class="action-dropdown" id="messagesDropdown">
                <button type="button" class="action-btn message-btn" data-dropdown-toggle="messages">
                    <img th:src="@{/images/icons/message.png}" alt="Mensagens" class="icon">
                    <span class="notification-badge" 
                          th:if="${messageCount > 0}" 
                          th:text="${messageCount > 99 ? '99+' : messageCount}">3</span>
                </button>
                <div class="dropdown-menu dropdown-messages" id="messages">
                    <div class="dropdown-header">
                        <h3 class="dropdown-title">Mensagens</h3>
                        <a th:href="@{/mensagens/nova}" class="dropdown-action">
                            <img th:src="@{/images/icons/edit.png}" alt="" class="icon icon-sm">
                        </a>
                    </div>
                    <div class="dropdown-body">
                        <ul class="message-list" th:if="${messages != null && !messages.empty}">
                            <li th:each="msg : ${messages}" 
                                class="message-item"
                                th:classappend="${!msg.lida} ? 'unread' : ''">
                                <a th:href="@{/mensagens/{id}(id=${msg.id})}" class="message-link">
                                    <div class="message-avatar">
                                        <img th:src="${msg.remetente.avatarUrl} ?: @{/images/icons/default-avatar.png}" 
                                             th:alt="${msg.remetente.nome}" class="avatar-img">
                                    </div>
                                    <div class="message-content">
                                        <div class="message-header">
                                            <span class="message-sender" th:text="${msg.remetente.nome}">Nome</span>
                                            <span class="message-time" th:text="${msg.tempoRelativo}">10:30</span>
                                        </div>
                                        <p class="message-preview" th:text="${msg.preview}">Preview da mensagem...</p>
                                    </div>
                                </a>
                            </li>
                        </ul>
                        <div class="dropdown-empty" th:if="${messages == null || messages.empty}">
                            <img th:src="@{/images/icons/inbox-empty.png}" alt="" class="icon icon-lg">
                            <p>Nenhuma mensagem</p>
                        </div>
                    </div>
                    <div class="dropdown-footer">
                        <a th:href="@{/mensagens}" class="dropdown-footer-link">Ver todas as mensagens</a>
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- User Menu -->
        <div class="user-menu" id="userMenu">
            <button type="button" class="user-menu-toggle" data-dropdown-toggle="userDropdown">
                <div class="user-avatar">
                    <img th:src="${currentUser.avatarUrl} ?: @{/images/icons/default-avatar.png}" 
                         th:alt="${currentUser.nome}" 
                         class="avatar-img">
                    <span class="status-indicator online"></span>
                </div>
                <div class="user-info">
                    <span class="user-name" th:text="${currentUser.nome}">Nome do Usuário</span>
                    <span class="user-role" th:text="${currentUser.cargo}">Cargo</span>
                </div>
                <img th:src="@{/images/icons/chevron-down.png}" alt="" class="icon icon-sm dropdown-arrow">
            </button>
            <div class="dropdown-menu dropdown-user" id="userDropdown">
                <div class="dropdown-user-header">
                    <div class="user-avatar user-avatar-lg">
                        <img th:src="${currentUser.avatarUrl} ?: @{/images/icons/default-avatar.png}" 
                             th:alt="${currentUser.nome}" 
                             class="avatar-img">
                    </div>
                    <div class="user-details">
                        <span class="user-name" th:text="${currentUser.nome}">Nome do Usuário</span>
                        <span class="user-email" th:text="${currentUser.email}">email@empresa.com</span>
                    </div>
                </div>
                <div class="dropdown-divider"></div>
                <ul class="dropdown-list">
                    <li class="dropdown-item">
                        <a th:href="@{/perfil}" class="dropdown-link">
                            <img th:src="@{/images/icons/user.png}" alt="" class="icon">
                            <span>Meu Perfil</span>
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a th:href="@{/conta/configuracoes}" class="dropdown-link">
                            <img th:src="@{/images/icons/settings.png}" alt="" class="icon">
                            <span>Configurações da Conta</span>
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a th:href="@{/atividade}" class="dropdown-link">
                            <img th:src="@{/images/icons/activity.png}" alt="" class="icon">
                            <span>Log de Atividades</span>
                        </a>
                    </li>
                </ul>
                <div class="dropdown-divider"></div>
                <ul class="dropdown-list">
                    <li class="dropdown-item">
                        <a th:href="@{/ajuda}" class="dropdown-link">
                            <img th:src="@{/images/icons/help-circle.png}" alt="" class="icon">
                            <span>Ajuda & Suporte</span>
                        </a>
                    </li>
                </ul>
                <div class="dropdown-divider"></div>
                <div class="dropdown-footer">
                    <a th:href="@{/logout}" class="dropdown-link dropdown-link-danger">
                        <img th:src="@{/images/icons/logout.png}" alt="" class="icon">
                        <span>Sair</span>
                    </a>
                </div>
            </div>
        </div>
        
    </div>
</header>

<!-- Fragment: Breadcrumb Item -->
<th:block th:fragment="breadcrumbItem(label, url, isLast)">
    <li class="breadcrumb-separator">
        <img th:src="@{/images/icons/chevron-right.png}" alt="" class="icon icon-xs">
    </li>
    <li class="breadcrumb-item" th:classappend="${isLast} ? 'active' : ''">
        <a th:href="${url}" th:text="${label}" th:if="${!isLast}" class="breadcrumb-link">Item</a>
        <span th:text="${label}" th:if="${isLast}" class="breadcrumb-current">Item Atual</span>
    </li>
</th:block>

</html>
