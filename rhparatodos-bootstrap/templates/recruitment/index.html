<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/head :: head('Recrutamento')}"></head>
<body>
    <div class="app-wrapper">
        <div th:replace="~{fragments/sidebar :: sidebar}"></div>
        
        <main class="main-content">
            <div th:replace="~{fragments/header :: header(${breadcrumbs})}"></div>
            <div th:replace="~{fragments/header :: alerts}"></div>
            
            <div class="content-wrapper">
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="card stat-card card-border-left">
                        <div class="card-body">
                            <i class="bi bi-briefcase stat-icon"></i>
                            <div class="stat-value" th:text="${stats?.vagasAbertas ?: 0}">12</div>
                            <div class="stat-label">Vagas Abertas</div>
                        </div>
                    </div>
                    <div class="card stat-card card-border-left info">
                        <div class="card-body">
                            <i class="bi bi-people stat-icon"></i>
                            <div class="stat-value" th:text="${stats?.totalCandidatos ?: 0}">156</div>
                            <div class="stat-label">Candidatos Ativos</div>
                        </div>
                    </div>
                    <div class="card stat-card card-border-left warning">
                        <div class="card-body">
                            <i class="bi bi-calendar-event stat-icon"></i>
                            <div class="stat-value" th:text="${stats?.entrevistasHoje ?: 0}">5</div>
                            <div class="stat-label">Entrevistas Hoje</div>
                        </div>
                    </div>
                    <div class="card stat-card card-border-left success">
                        <div class="card-body">
                            <i class="bi bi-check-circle stat-icon"></i>
                            <div class="stat-value" th:text="${stats?.contratacoesMes ?: 0}">8</div>
                            <div class="stat-label">Contratações (mês)</div>
                        </div>
                    </div>
                </div>
                
                <!-- Page Header -->
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Recrutamento e Seleção</h1>
                        <p class="page-subtitle">Gerencie vagas e processos seletivos</p>
                    </div>
                    <div class="page-actions">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalVaga">
                            <i class="bi bi-plus-lg me-1"></i> Nova Vaga
                        </button>
                    </div>
                </div>
                
                <!-- Tabs -->
                <ul class="nav nav-tabs mb-4" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tabVagas">
                            <i class="bi bi-briefcase me-1"></i> Vagas
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabCandidatos">
                            <i class="bi bi-people me-1"></i> Candidatos
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabEntrevistas">
                            <i class="bi bi-calendar-event me-1"></i> Entrevistas
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content">
                    <!-- Tab Vagas -->
                    <div class="tab-pane fade show active" id="tabVagas">
                        <div class="row">
                            <div th:each="vaga : ${vagas}" class="col-lg-4 col-md-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <span class="badge" th:classappend="${vaga.status == 'ABERTA' ? 'bg-success' : (vaga.status == 'PAUSADA' ? 'bg-warning' : 'bg-secondary')}"
                                              th:text="${vaga.statusDescricao}">Aberta</span>
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-link" data-bs-toggle="dropdown">
                                                <i class="bi bi-three-dots-vertical"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                <li><a class="dropdown-item" href="#" th:onclick="'editarVaga(' + ${vaga.id} + ')'"><i class="bi bi-pencil me-2"></i>Editar</a></li>
                                                <li><a class="dropdown-item" th:href="@{/recrutamento/vagas/{id}/candidatos(id=${vaga.id})}"><i class="bi bi-people me-2"></i>Ver Candidatos</a></li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li><a class="dropdown-item text-danger" href="#"><i class="bi bi-x-circle me-2"></i>Encerrar</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <h5 class="card-title" th:text="${vaga.titulo}">Desenvolvedor Backend</h5>
                                        <p class="text-muted small mb-3">
                                            <i class="bi bi-building me-1"></i> <span th:text="${vaga.departamento}">Tecnologia</span>
                                            <span class="mx-2">•</span>
                                            <i class="bi bi-geo-alt me-1"></i> <span th:text="${vaga.modalidade}">Híbrido</span>
                                        </p>
                                        
                                        <div class="d-flex flex-wrap gap-1 mb-3">
                                            <span class="badge bg-light text-dark" th:text="${vaga.tipo}">CLT</span>
                                            <span class="badge bg-light text-dark" th:text="${vaga.nivel}">Senior</span>
                                        </div>
                                        
                                        <div class="d-flex justify-content-between align-items-center small text-muted">
                                            <span><i class="bi bi-people me-1"></i> <span th:text="${vaga.candidatos}">24</span> candidatos</span>
                                            <span th:text="'Aberta há ' + ${vaga.diasAberta} + ' dias'">Aberta há 15 dias</span>
                                        </div>
                                    </div>
                                    <div class="card-footer bg-transparent">
                                        <a th:href="@{/recrutamento/vagas/{id}(id=${vaga.id})}" class="btn btn-sm btn-outline-primary w-100">
                                            Ver Detalhes
                                        </a>
                                    </div>
                                </div>
                            </div>
                            
                            <div th:if="${vagas == null || vagas.isEmpty()}" class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div th:replace="~{fragments/scripts :: empty-state('bi-briefcase', 'Nenhuma vaga cadastrada', 'Clique em Nova Vaga para criar a primeira.')}"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tab Candidatos -->
                    <div class="tab-pane fade" id="tabCandidatos">
                        <div class="card">
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>Candidato</th>
                                                <th>Vaga</th>
                                                <th>Etapa</th>
                                                <th>Data Aplicação</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="cand : ${candidatos}">
                                                <td>
                                                    <div class="cell-with-avatar">
                                                        <div class="cell-avatar" th:text="${#strings.substring(cand.nome, 0, 1)}">J</div>
                                                        <div class="cell-info">
                                                            <span class="cell-title" th:text="${cand.nome}">João Silva</span>
                                                            <span class="cell-subtitle" th:text="${cand.email}">joao@email.com</span>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td th:text="${cand.vaga}">Dev Backend</td>
                                                <td>
                                                    <span class="badge" th:classappend="${cand.etapaClass}" th:text="${cand.etapa}">Triagem</span>
                                                </td>
                                                <td th:text="${#temporals.format(cand.dataAplicacao, 'dd/MM/yyyy')}">15/01/2026</td>
                                                <td>
                                                    <div class="table-actions">
                                                        <button class="btn-table-action view" title="Ver Currículo"><i class="bi bi-file-text"></i></button>
                                                        <button class="btn-table-action" title="Agendar Entrevista"><i class="bi bi-calendar-plus"></i></button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tab Entrevistas -->
                    <div class="tab-pane fade" id="tabEntrevistas">
                        <div class="card">
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>Candidato</th>
                                                <th>Vaga</th>
                                                <th>Data/Hora</th>
                                                <th>Entrevistador</th>
                                                <th>Status</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="ent : ${entrevistas}">
                                                <td th:text="${ent.candidatoNome}">Maria Santos</td>
                                                <td th:text="${ent.vaga}">Analista RH</td>
                                                <td th:text="${#temporals.format(ent.dataHora, 'dd/MM/yyyy HH:mm')}">20/01/2026 14:00</td>
                                                <td th:text="${ent.entrevistador}">Carlos Lima</td>
                                                <td>
                                                    <span class="badge" th:classappend="${ent.statusClass}" th:text="${ent.status}">Agendada</span>
                                                </td>
                                                <td>
                                                    <div class="table-actions">
                                                        <button class="btn-table-action view" title="Feedback"><i class="bi bi-chat-text"></i></button>
                                                        <button class="btn-table-action edit" title="Reagendar"><i class="bi bi-calendar"></i></button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Modal Nova Vaga -->
    <div class="modal fade" id="modalVaga" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form th:action="@{/recrutamento/vagas/salvar}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <div class="modal-header">
                        <h5 class="modal-title">Nova Vaga</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label class="form-label required">Título da Vaga</label>
                                <input type="text" class="form-control" name="titulo" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label required">Departamento</label>
                                <select class="form-select" name="departamentoId" required>
                                    <option value="">Selecione</option>
                                    <option th:each="d : ${departamentos}" th:value="${d.id}" th:text="${d.nome}">Dept</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Tipo de Contrato</label>
                                <select class="form-select" name="tipo">
                                    <option value="CLT">CLT</option>
                                    <option value="PJ">PJ</option>
                                    <option value="ESTAGIO">Estágio</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Nível</label>
                                <select class="form-select" name="nivel">
                                    <option value="JUNIOR">Junior</option>
                                    <option value="PLENO">Pleno</option>
                                    <option value="SENIOR">Senior</option>
                                    <option value="GESTAO">Gestão</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Modalidade</label>
                                <select class="form-select" name="modalidade">
                                    <option value="PRESENCIAL">Presencial</option>
                                    <option value="HIBRIDO">Híbrido</option>
                                    <option value="REMOTO">Remoto</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Faixa Salarial (de)</label>
                                <input type="text" class="form-control" name="salarioMin" data-mask="currency">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Faixa Salarial (até)</label>
                                <input type="text" class="form-control" name="salarioMax" data-mask="currency">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Descrição da Vaga</label>
                            <textarea class="form-control" name="descricao" rows="4"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Requisitos</label>
                            <textarea class="form-control" name="requisitos" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Publicar Vaga</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div th:replace="~{fragments/scripts :: scripts}"></div>
</body>
</html>
