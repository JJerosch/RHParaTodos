<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>
<!-- Header -->
<header class="top-header" th:fragment="header(breadcrumbs)">
    <div class="header-left">
        <!-- Toggle Sidebar -->
        <button type="button" class="sidebar-toggle" onclick="Sidebar.toggle()">
            <i class="bi bi-list"></i>
        </button>
        
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item">
                    <a th:href="@{/dashboard}"><i class="bi bi-house"></i></a>
                </li>
                <th:block th:each="item, stat : ${breadcrumbs}">
                    <li class="breadcrumb-item" th:classappend="${stat.last} ? 'active'" 
                        th:attr="aria-current=${stat.last} ? 'page' : null">
                        <a th:if="${!stat.last}" th:href="${item.url}" th:text="${item.label}">Item</a>
                        <span th:if="${stat.last}" th:text="${item.label}">Item</span>
                    </li>
                </th:block>
            </ol>
        </nav>
    </div>
    
    <div class="header-right">
        <!-- Busca Rápida -->
        <div class="d-none d-md-block">
            <div class="input-group input-group-sm" style="width: 250px;">
                <input type="text" class="form-control" placeholder="Buscar..." id="globalSearch">
                <button class="btn btn-outline-secondary" type="button">
                    <i class="bi bi-search"></i>
                </button>
            </div>
        </div>
        
        <!-- Notificações -->
        <div class="dropdown">
            <button class="header-icon-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-bell"></i>
                <span class="notification-badge" th:if="${notificacoesNaoLidas > 0}" 
                      th:text="${notificacoesNaoLidas}">3</span>
            </button>
            <div class="dropdown-menu dropdown-menu-end" style="width: 320px;">
                <div class="px-3 py-2 border-bottom">
                    <strong>Notificações</strong>
                </div>
                <div class="notification-list" style="max-height: 300px; overflow-y: auto;">
                    <th:block th:if="${notificacoes != null && !notificacoes.isEmpty()}">
                        <a th:each="notif : ${notificacoes}" th:href="${notif.url}" 
                           class="dropdown-item py-2 border-bottom">
                            <div class="d-flex align-items-start gap-2">
                                <i class="bi" th:classappend="${notif.icone}" 
                                   th:style="'color:' + ${notif.cor}"></i>
                                <div class="flex-grow-1">
                                    <div class="small fw-medium" th:text="${notif.titulo}">Título</div>
                                    <div class="small text-muted" th:text="${notif.mensagem}">Mensagem</div>
                                    <div class="small text-muted" 
                                         th:text="${#temporals.format(notif.data, 'dd/MM HH:mm')}">00/00 00:00</div>
                                </div>
                            </div>
                        </a>
                    </th:block>
                    <div th:if="${notificacoes == null || notificacoes.isEmpty()}" 
                         class="p-3 text-center text-muted">
                        <i class="bi bi-bell-slash fs-3 d-block mb-2"></i>
                        Nenhuma notificação
                    </div>
                </div>
                <div class="p-2 border-top text-center" th:if="${notificacoes != null && !notificacoes.isEmpty()}">
                    <a th:href="@{/notificacoes}" class="small">Ver todas</a>
                </div>
            </div>
        </div>
        
        <!-- Mensagens -->
        <button class="header-icon-btn" type="button" th:onclick="'window.location.href=\'' + @{/mensagens} + '\''">
            <i class="bi bi-envelope"></i>
            <span class="notification-badge" th:if="${mensagensNaoLidas > 0}" 
                  th:text="${mensagensNaoLidas}">2</span>
        </button>
        
        <!-- Menu do Usuário -->
        <div class="dropdown">
            <div class="user-menu" data-bs-toggle="dropdown" aria-expanded="false">
                <div class="user-avatar" th:text="${#strings.substring(usuarioLogado.nome, 0, 1)}">A</div>
                <div class="user-info d-none d-sm-block">
                    <div class="user-name" th:text="${usuarioLogado.nome}">Usuário</div>
                    <div class="user-role" th:text="${usuarioLogado.perfilDescricao}">Perfil</div>
                </div>
                <i class="bi bi-chevron-down small text-muted"></i>
            </div>
            <ul class="dropdown-menu dropdown-menu-end">
                <li>
                    <div class="px-3 py-2">
                        <div class="fw-medium" th:text="${usuarioLogado.nome}">Nome</div>
                        <div class="small text-muted" th:text="${usuarioLogado.email}">email@exemplo.com</div>
                    </div>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                    <a class="dropdown-item" th:href="@{/perfil}">
                        <i class="bi bi-person"></i> Meu Perfil
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" th:href="@{/configuracoes/conta}">
                        <i class="bi bi-gear"></i> Configurações
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" th:href="@{/ajuda}">
                        <i class="bi bi-question-circle"></i> Ajuda
                    </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                    <form th:action="@{/logout}" method="post" class="m-0">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button type="submit" class="dropdown-item text-danger">
                            <i class="bi bi-box-arrow-right"></i> Sair
                        </button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</header>

<!-- Alertas de Mensagens Flash -->
<div th:fragment="alerts" class="px-3 pt-3">
    <!-- Sucesso -->
    <div th:if="${mensagemSucesso}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>
        <span th:text="${mensagemSucesso}">Operação realizada com sucesso!</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
    </div>
    
    <!-- Erro -->
    <div th:if="${mensagemErro}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-x-circle-fill me-2"></i>
        <span th:text="${mensagemErro}">Ocorreu um erro!</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
    </div>
    
    <!-- Aviso -->
    <div th:if="${mensagemAviso}" class="alert alert-warning alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <span th:text="${mensagemAviso}">Atenção!</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
    </div>
    
    <!-- Info -->
    <div th:if="${mensagemInfo}" class="alert alert-info alert-dismissible fade show" role="alert">
        <i class="bi bi-info-circle-fill me-2"></i>
        <span th:text="${mensagemInfo}">Informação</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
    </div>
</div>
</body>
</html>
