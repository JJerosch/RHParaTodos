<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/head :: head('Visualizar Funcionário')}"></head>
<body>
    <div class="app-wrapper">
        <div th:replace="~{fragments/sidebar :: sidebar}"></div>
        
        <main class="main-content">
            <div th:replace="~{fragments/header :: header(${breadcrumbs})}"></div>
            <div th:replace="~{fragments/header :: alerts}"></div>
            
            <div class="content-wrapper">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="d-flex align-items-center gap-3">
                        <div class="cell-avatar" style="width: 64px; height: 64px; font-size: 1.5rem;"
                             th:text="${#strings.substring(funcionario.nomeCompleto, 0, 2)}">JS</div>
                        <div>
                            <h1 class="page-title mb-1" th:text="${funcionario.nomeCompleto}">João Silva Santos</h1>
                            <div class="d-flex gap-3 text-muted">
                                <span><i class="bi bi-briefcase me-1"></i><span th:text="${funcionario.cargo?.titulo}">Analista de Sistemas</span></span>
                                <span><i class="bi bi-building me-1"></i><span th:text="${funcionario.departamento?.nome}">Tecnologia</span></span>
                                <span class="badge badge-status ms-2" 
                                      th:classappend="${funcionario.status == 'ATIVO' ? 'badge-ativo' : (funcionario.status == 'FERIAS' ? 'badge-ferias' : (funcionario.status == 'AFASTADO' ? 'badge-afastado' : 'badge-desligado'))}"
                                      th:text="${funcionario.statusDescricao}">Ativo</span>
                            </div>
                        </div>
                    </div>
                    <div class="page-actions">
                        <a th:href="@{/funcionarios}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left me-1"></i> Voltar
                        </a>
                        <a th:href="@{/funcionarios/{id}/editar(id=${funcionario.id})}" class="btn btn-primary"
                           sec:authorize="hasAnyRole('ADMIN', 'RH_CHEFE', 'RH_ASSISTENTE')">
                            <i class="bi bi-pencil me-1"></i> Editar
                        </a>
                    </div>
                </div>
                
                <!-- Quick Stats -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <div class="text-muted small">Matrícula</div>
                                <div class="fs-5 fw-bold" th:text="${funcionario.matricula}">000001</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <div class="text-muted small">Admissão</div>
                                <div class="fs-5 fw-bold" th:text="${#temporals.format(funcionario.dataAdmissao, 'dd/MM/yyyy')}">01/03/2020</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <div class="text-muted small">Tempo de Casa</div>
                                <div class="fs-5 fw-bold" th:text="${funcionario.tempoCasa}">5 anos, 10 meses</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <div class="text-muted small">Salário Atual</div>
                                <div class="fs-5 fw-bold" th:text="${#numbers.formatCurrency(funcionario.salarioAtual)}"
                                     sec:authorize="hasAnyRole('ADMIN', 'RH_CHEFE', 'DP_CHEFE')">R$ 8.500,00</div>
                                <div class="fs-5 fw-bold" sec:authorize="!hasAnyRole('ADMIN', 'RH_CHEFE', 'DP_CHEFE')">••••••</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tabs -->
                <ul class="nav nav-tabs mb-4" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tabDados">
                            <i class="bi bi-person me-1"></i> Dados Pessoais
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabProfissional">
                            <i class="bi bi-briefcase me-1"></i> Profissional
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabHistorico">
                            <i class="bi bi-clock-history me-1"></i> Histórico
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabFerias">
                            <i class="bi bi-calendar-check me-1"></i> Férias
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabTreinamentos">
                            <i class="bi bi-mortarboard me-1"></i> Treinamentos
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabAvaliacoes">
                            <i class="bi bi-graph-up me-1"></i> Avaliações
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content">
                    <!-- Tab Dados Pessoais -->
                    <div class="tab-pane fade show active" id="tabDados">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="bi bi-person me-2"></i>Informações Pessoais
                                    </div>
                                    <div class="card-body">
                                        <dl class="row mb-0">
                                            <dt class="col-sm-4 text-muted">Nome Completo</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.nomeCompleto}">João Silva Santos</dd>
                                            
                                            <dt class="col-sm-4 text-muted">CPF</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.cpf}">123.456.789-00</dd>
                                            
                                            <dt class="col-sm-4 text-muted">RG</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.rg ?: '-'}">12.345.678-9</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Data Nascimento</dt>
                                            <dd class="col-sm-8" th:text="${#temporals.format(funcionario.dataNascimento, 'dd/MM/yyyy')}">15/05/1990</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Sexo</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.sexoDescricao ?: '-'}">Masculino</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Estado Civil</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.estadoCivilDescricao ?: '-'}">Casado</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Nacionalidade</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.nacionalidade ?: 'Brasileiro(a)'}">Brasileiro</dd>
                                        </dl>
                                    </div>
                                </div>
                                
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="bi bi-file-text me-2"></i>Documentos
                                    </div>
                                    <div class="card-body">
                                        <dl class="row mb-0">
                                            <dt class="col-sm-4 text-muted">PIS/PASEP</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.pis ?: '-'}">123.45678.90-1</dd>
                                            
                                            <dt class="col-sm-4 text-muted">CTPS</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.ctpsNumero != null ? funcionario.ctpsNumero + '/' + funcionario.ctpsSerie : '-'}">123456/0001</dd>
                                            
                                            <dt class="col-sm-4 text-muted">CNH</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.cnhNumero != null ? funcionario.cnhNumero + ' - Cat. ' + funcionario.cnhCategoria : '-'}">123456789 - Cat. B</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="bi bi-telephone me-2"></i>Contato
                                    </div>
                                    <div class="card-body">
                                        <dl class="row mb-0">
                                            <dt class="col-sm-4 text-muted">Celular</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.telefoneCelular ?: '-'}">(11) 99999-9999</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Telefone Fixo</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.telefoneFixo ?: '-'}">(11) 3333-3333</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Email Pessoal</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.emailPessoal ?: '-'}">joao@email.com</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Email Corporativo</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.emailCorporativo ?: '-'}">joao.silva@empresa.com</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Emergência</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.telefoneEmergencia ?: '-'}">(11) 98888-8888</dd>
                                        </dl>
                                    </div>
                                </div>
                                
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="bi bi-geo-alt me-2"></i>Endereço
                                    </div>
                                    <div class="card-body">
                                        <p class="mb-1" th:text="${funcionario.logradouro != null ? funcionario.logradouro + ', ' + funcionario.numero : '-'}">
                                            Rua das Flores, 123
                                        </p>
                                        <p class="mb-1" th:if="${funcionario.complemento != null}" th:text="${funcionario.complemento}">Apto 45</p>
                                        <p class="mb-1" th:text="${funcionario.bairro ?: ''}">Centro</p>
                                        <p class="mb-1" th:text="${funcionario.cidade != null ? funcionario.cidade + ' - ' + funcionario.uf : '-'}">São Paulo - SP</p>
                                        <p class="mb-0 text-muted" th:text="${'CEP: ' + (funcionario.cep ?: '-')}">CEP: 01234-567</p>
                                    </div>
                                </div>
                                
                                <div class="card mb-4" sec:authorize="hasAnyRole('ADMIN', 'RH_CHEFE', 'DP_CHEFE', 'DP_ASSISTENTE')">
                                    <div class="card-header">
                                        <i class="bi bi-bank me-2"></i>Dados Bancários
                                    </div>
                                    <div class="card-body">
                                        <dl class="row mb-0">
                                            <dt class="col-sm-4 text-muted">Banco</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.bancoDescricao ?: '-'}">341 - Itaú</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Agência</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.agencia ?: '-'}">1234</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Conta</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.conta ?: '-'}">12345-6</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Tipo</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.tipoContaDescricao ?: '-'}">Corrente</dd>
                                            
                                            <dt class="col-sm-4 text-muted">PIX</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.chavePix ?: '-'}">CPF</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Dependentes -->
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-people me-2"></i>Dependentes
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>Nome</th>
                                                <th>Parentesco</th>
                                                <th>Data Nascimento</th>
                                                <th>CPF</th>
                                                <th>IR</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="dep : ${funcionario.dependentes}">
                                                <td th:text="${dep.nome}">Maria Silva</td>
                                                <td th:text="${dep.parentescoDescricao}">Cônjuge</td>
                                                <td th:text="${#temporals.format(dep.dataNascimento, 'dd/MM/yyyy')}">10/03/1992</td>
                                                <td th:text="${dep.cpf ?: '-'}">987.654.321-00</td>
                                                <td>
                                                    <i class="bi" th:classappend="${dep.declaradoIr ? 'bi-check-circle text-success' : 'bi-x-circle text-danger'}"></i>
                                                </td>
                                            </tr>
                                            <tr th:if="${funcionario.dependentes == null || funcionario.dependentes.isEmpty()}">
                                                <td colspan="5" class="text-center text-muted py-3">Nenhum dependente cadastrado</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tab Profissional -->
                    <div class="tab-pane fade" id="tabProfissional">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <i class="bi bi-briefcase me-2"></i>Dados do Cargo
                                    </div>
                                    <div class="card-body">
                                        <dl class="row mb-0">
                                            <dt class="col-sm-4 text-muted">Cargo</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.cargo?.titulo ?: '-'}">Analista de Sistemas</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Departamento</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.departamento?.nome ?: '-'}">Tecnologia</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Gestor</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.gestor?.nomeCompleto ?: '-'}">Carlos Lima</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Tipo Contrato</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.tipoContratoDescricao ?: 'CLT'}">CLT</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Carga Horária</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.cargaHoraria + 'h/semana'}">44h/semana</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Centro de Custo</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.centroCusto ?: '-'}">TI-001</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card mb-4" sec:authorize="hasAnyRole('ADMIN', 'RH_CHEFE', 'DP_CHEFE')">
                                    <div class="card-header">
                                        <i class="bi bi-cash-stack me-2"></i>Remuneração
                                    </div>
                                    <div class="card-body">
                                        <dl class="row mb-0">
                                            <dt class="col-sm-4 text-muted">Salário Base</dt>
                                            <dd class="col-sm-8 fs-5 fw-bold" th:text="${#numbers.formatCurrency(funcionario.salarioAtual)}">R$ 8.500,00</dd>
                                            
                                            <dt class="col-sm-4 text-muted">Último Reajuste</dt>
                                            <dd class="col-sm-8" th:text="${funcionario.ultimoReajuste != null ? #temporals.format(funcionario.ultimoReajuste, 'dd/MM/yyyy') : '-'}">01/01/2026</dd>
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tab Histórico -->
                    <div class="tab-pane fade" id="tabHistorico">
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-clock-history me-2"></i>Histórico de Movimentações
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>Data</th>
                                                <th>Tipo</th>
                                                <th>Descrição</th>
                                                <th>Responsável</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="mov : ${historico}">
                                                <td th:text="${#temporals.format(mov.data, 'dd/MM/yyyy')}">15/01/2026</td>
                                                <td>
                                                    <span class="badge" th:classappend="${mov.tipo == 'PROMOCAO' ? 'bg-success' : (mov.tipo == 'REAJUSTE' ? 'bg-info' : 'bg-secondary')}"
                                                          th:text="${mov.tipoDescricao}">Promoção</span>
                                                </td>
                                                <td th:text="${mov.descricao}">Promovido de Analista Pleno para Senior</td>
                                                <td th:text="${mov.responsavel}">Maria Costa</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tab Férias -->
                    <div class="tab-pane fade" id="tabFerias">
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <div class="text-muted small">Dias Disponíveis</div>
                                        <div class="fs-3 fw-bold text-success" th:text="${feriasInfo?.diasDisponiveis ?: 0}">30</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <div class="text-muted small">Período Aquisitivo</div>
                                        <div class="fs-5 fw-bold" th:text="${feriasInfo?.periodoAquisitivo ?: '-'}">2025/2026</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <div class="text-muted small">Vencimento</div>
                                        <div class="fs-5 fw-bold" th:text="${feriasInfo?.vencimento != null ? #temporals.format(feriasInfo.vencimento, 'dd/MM/yyyy') : '-'}">28/02/2027</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-calendar-check me-2"></i>Histórico de Férias
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>Período Aquisitivo</th>
                                                <th>Início</th>
                                                <th>Fim</th>
                                                <th>Dias</th>
                                                <th>Abono</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="ferias : ${historicoFerias}">
                                                <td th:text="${ferias.periodoAquisitivo}">2024/2025</td>
                                                <td th:text="${#temporals.format(ferias.dataInicio, 'dd/MM/yyyy')}">01/07/2025</td>
                                                <td th:text="${#temporals.format(ferias.dataFim, 'dd/MM/yyyy')}">30/07/2025</td>
                                                <td th:text="${ferias.dias}">30</td>
                                                <td th:text="${ferias.abonoPecuniario ? 'Sim' : 'Não'}">Não</td>
                                                <td>
                                                    <span class="badge bg-success">Gozada</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tab Treinamentos -->
                    <div class="tab-pane fade" id="tabTreinamentos">
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-mortarboard me-2"></i>Treinamentos Realizados
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>Treinamento</th>
                                                <th>Categoria</th>
                                                <th>Carga Horária</th>
                                                <th>Data Conclusão</th>
                                                <th>Nota</th>
                                                <th>Certificado</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="trein : ${treinamentos}">
                                                <td th:text="${trein.nome}">Gestão de Projetos</td>
                                                <td>
                                                    <span class="badge bg-info" th:text="${trein.categoria}">Técnico</span>
                                                </td>
                                                <td th:text="${trein.cargaHoraria + 'h'}">16h</td>
                                                <td th:text="${#temporals.format(trein.dataConclusao, 'dd/MM/yyyy')}">10/01/2026</td>
                                                <td th:text="${trein.nota != null ? trein.nota : '-'}">9.5</td>
                                                <td>
                                                    <a th:if="${trein.certificado != null}" href="#" class="btn btn-sm btn-outline-primary">
                                                        <i class="bi bi-award"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tab Avaliações -->
                    <div class="tab-pane fade" id="tabAvaliacoes">
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-graph-up me-2"></i>Histórico de Avaliações
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>Ciclo</th>
                                                <th class="text-center">Autoavaliação</th>
                                                <th class="text-center">Avaliação Gestor</th>
                                                <th class="text-center">Nota Final</th>
                                                <th>Classificação</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="aval : ${avaliacoes}">
                                                <td th:text="${aval.ciclo}">2025.2</td>
                                                <td class="text-center" th:text="${aval.notaAuto}">4.5</td>
                                                <td class="text-center" th:text="${aval.notaGestor}">4.3</td>
                                                <td class="text-center">
                                                    <span class="badge fs-6" th:classappend="${aval.notaFinal >= 4 ? 'bg-success' : (aval.notaFinal >= 3 ? 'bg-warning text-dark' : 'bg-danger')}"
                                                          th:text="${aval.notaFinal}">4.4</span>
                                                </td>
                                                <td th:text="${aval.classificacao}">Alto Desempenho</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div th:replace="~{fragments/scripts :: scripts}"></div>
</body>
</html>
