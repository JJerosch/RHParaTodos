<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Férias - Sistema RH</title>
  <link rel="stylesheet" href="public/styles/global.css">
  <link rel="stylesheet" href="public/styles/dashboard.css">
  <link rel="stylesheet" href="public/styles/components.css">
</head>
<body>
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <img src="/front/public/assets/gruporhpaint.png" alt="logo_menu_lateral" height="60">
      </div>
    </div>
    <nav class="sidebar-nav">
      <a href="dashboard.html" class="nav-item">
        <span class="nav-text">Dashboard</span>
      </a>
      
      <div class="nav-section">Gestão de Pessoas</div>
      <a href="employees.html" class="nav-item">
        <span class="nav-text">Funcionários</span>
      </a>
      <a href="departments.html" class="nav-item">
        <span class="nav-text">Departamentos</span>
      </a>
      <a href="positions.html" class="nav-item">
        <span class="nav-text">Cargos</span>
      </a>
      
      <div class="nav-section">Recursos Humanos</div>
      <a href="recruitment.html" class="nav-item">
        <span class="nav-text">Recrutamento</span>
      </a>
      <a href="training.html" class="nav-item">
        <span class="nav-text">Treinamentos</span>
      </a>
      <a href="performance.html" class="nav-item">
        <span class="nav-text">Avaliações</span>
      </a>
      
      <div class="nav-section">Departamento Pessoal</div>
      <a href="payroll.html" class="nav-item">
        <span class="nav-text">Folha de Pagamento</span>
      </a>
      <a href="benefits.html" class="nav-item">
        <span class="nav-text">Benefícios</span>
      </a>
      <a href="vacation.html" class="nav-item active">
        <span class="nav-text">Férias</span>
      </a>
      <a href="timesheet.html" class="nav-item">
        <span class="nav-text">Ponto</span>
      </a>
      
      <div class="nav-section">Administração</div>
      <a href="reports.html" class="nav-item">
        <span class="nav-text">Relatórios</span>
      </a>
      <a href="settings.html" class="nav-item">
        <span class="nav-text">Configurações</span>
      </a>
    </nav>
  </aside>


  <div class="main-content">
    <header class="topbar">
      <div class="topbar-left">
        <button class="mobile-menu-btn" id="mobileMenuBtn">☰</button>
        <h1>Gestão de Férias</h1>
      </div>
      <div class="topbar-right">
        <div class="user-menu">
          <button class="user-button" id="userMenuButton">
            <span class="user-avatar" id="userAvatar">U</span>
            <span class="user-name" id="userName">Usuário</span>
            <span class="user-arrow">▼</span>
          </button>
          <div class="user-dropdown" id="userDropdown">
            <div class="user-info">
              <strong id="userFullName">Nome do Usuário</strong>
              <small id="userProfile">Perfil</small>
            </div>
            <hr>
            <a href="#" class="dropdown-item">Meu Perfil</a>
            <a href="settings.html" class="dropdown-item">Configurações</a>
            <hr>
            <a href="#" class="dropdown-item" id="logoutButton">Sair</a>
          </div>
        </div>
      </div>
    </header>

    <div class="content-area">
      <div class="stats-row">
        <div class="stat-box"><div class="stat-box-icon" style="background: rgba(39, 174, 96, 0.1); color: var(--success-green);"><img src="/front/public/assets/check (1).png" alt="icone_ferias_aprovadas"></div><div class="stat-box-value" id="statAprovadas">8</div><div class="stat-box-label">Férias Aprovadas</div></div>
        <div class="stat-box"><div class="stat-box-icon" style="background: rgba(243, 156, 18, 0.1); color: var(--warning-orange);"><img src="/front/public/assets/hourglass.png" alt="icone_pendentes"></div><div class="stat-box-value" id="statPendentes">5</div><div class="stat-box-label">Pendentes</div></div>
        <div class="stat-box"><div class="stat-box-icon" style="background: rgba(44, 62, 80, 0.1); color: var(--primary-dark);"><img src="/front/public/assets/tree-palm (1).png" alt="icone_em_ferias"></div><div class="stat-box-value" id="statEmFerias">3</div><div class="stat-box-label">Em Férias Agora</div></div>
        <div class="stat-box"><div class="stat-box-icon" style="background: rgba(231, 76, 60, 0.1); color: var(--error-red);"><img src="/front/public/assets/triangle-alert.png" alt="icone_ferias_vencidas"></div><div class="stat-box-value" id="statVencidas">12</div><div class="stat-box-label">Férias Vencidas</div></div>
      </div>

      <div class="page-header">
        <div><h2 class="page-title">Solicitações de Férias</h2><p class="page-subtitle">Gerencie as solicitações e programações de férias</p></div>
        <div class="page-actions">
          <button class="btn btn-primary" onclick="openModal()"><img src="/front/public/assets/plus.png" alt="icone_nova_solicitacao"> Nova Solicitação</button>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs" data-tab-content="tabsContent">
        <button class="tab-btn active" data-tab="solicitacoes">Solicitações</button>
        <button class="tab-btn" data-tab="programadas">Programadas</button>
        <button class="tab-btn" data-tab="vencidas">Férias Vencidas</button>
      </div>

      <div id="tabsContent">
        <!-- Tab Solicitações -->
        <div class="tab-content active" data-tab-content="solicitacoes">
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Funcionário</th>
                  <th>Período</th>
                  <th class="hide-mobile">Dias</th>
                  <th class="hide-mobile">Solicitado em</th>
                  <th>Status</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="solicitacoesBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Tab Programadas -->
        <div class="tab-content" data-tab-content="programadas">
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Funcionário</th>
                  <th>Início</th>
                  <th>Fim</th>
                  <th class="hide-mobile">Dias</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="programadasBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Tab Vencidas -->
        <div class="tab-content" data-tab-content="vencidas">
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Funcionário</th>
                  <th>Período Aquisitivo</th>
                  <th>Dias Disponíveis</th>
                  <th>Vencimento</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="vencidasBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Solicitação -->
  <div class="modal" id="modal">
    <div class="modal-dialog modal-md">
      <div class="modal-header"><h3 class="modal-title">Nova Solicitação de Férias</h3><button class="modal-close" onclick="Modal.close('modal')">&times;</button></div>
      <div class="modal-body">
        <form id="form">
          <div class="form-group">
            <label class="form-label">Funcionário *</label>
            <select class="form-select" name="funcionario_id" required>
              <option value="">Selecione</option>
              <option value="1">João Silva Santos</option>
              <option value="2">Maria Oliveira Costa</option>
              <option value="3">Pedro Henrique Almeida</option>
              <option value="4">Ana Paula Ferreira</option>
            </select>
          </div>
          <div class="form-row form-row-2">
            <div class="form-group"><label class="form-label">Data Início *</label><input type="date" class="form-input" name="data_inicio" required></div>
            <div class="form-group"><label class="form-label">Data Fim *</label><input type="date" class="form-input" name="data_fim" required></div>
          </div>
          <div class="form-row form-row-2">
            <div class="form-group"><label class="form-label">Dias de Férias</label><input type="number" class="form-input" name="dias" value="30" min="5" max="30"></div>
            <div class="form-group"><label class="form-label">Abono Pecuniário</label><select class="form-select" name="abono"><option value="false">Não</option><option value="true">Sim (vender 10 dias)</option></select></div>
          </div>
          <div class="form-group"><label class="form-label">Observações</label><textarea class="form-input" name="observacoes" rows="2"></textarea></div>
        </form>
      </div>
      <div class="modal-footer"><button class="btn btn-secondary" onclick="Modal.close('modal')">Cancelar</button><button class="btn btn-primary" onclick="save()">Solicitar</button></div>
    </div>
  </div>

  <!-- Modal Calendário -->
  <div class="modal" id="calendarModal">
    <div class="modal-dialog modal-lg">
      <div class="modal-header"><h3 class="modal-title">Calendário de Férias</h3><button class="modal-close" onclick="Modal.close('calendarModal')">&times;</button></div>
      <div class="modal-body">
        <div id="calendarView"></div>
      </div>
    </div>
  </div>

  <script src="public/scripts/auth.js"></script>
  <script src="public/scripts/components.js"></script>
  <script>
    const solicitacoes = [
      { id: 1, nome: "João Silva Santos", inicio: "2026-02-01", fim: "2026-02-28", dias: 28, solicitado: "2026-01-05", status: "PENDENTE" },
      { id: 2, nome: "Maria Oliveira Costa", inicio: "2026-03-15", fim: "2026-04-05", dias: 20, solicitado: "2026-01-08", status: "APROVADO" },
      { id: 3, nome: "Pedro Henrique Almeida", inicio: "2026-02-10", fim: "2026-02-20", dias: 10, solicitado: "2026-01-10", status: "PENDENTE" },
      { id: 4, nome: "Carlos Eduardo Lima", inicio: "2026-04-01", fim: "2026-04-30", dias: 30, solicitado: "2026-01-12", status: "PENDENTE" },
      { id: 5, nome: "Fernanda Gomes", inicio: "2026-05-05", fim: "2026-05-25", dias: 20, solicitado: "2026-01-11", status: "APROVADO" }
    ];

    const programadas = [
      { id: 1, nome: "Ana Paula Ferreira", inicio: "2026-01-15", fim: "2026-02-10", dias: 26, status: "EM_FERIAS" },
      { id: 2, nome: "Roberto Martins", inicio: "2026-01-20", fim: "2026-02-05", dias: 16, status: "EM_FERIAS" },
      { id: 3, nome: "Juliana Ribeiro", inicio: "2026-01-25", fim: "2026-02-08", dias: 14, status: "EM_FERIAS" },
      { id: 4, nome: "Maria Oliveira Costa", inicio: "2026-03-15", fim: "2026-04-05", dias: 20, status: "AGENDADO" }
    ];

    const vencidas = [
      { id: 1, nome: "Lucas Nunes", periodo: "2024/2025", dias: 30, vencimento: "2026-01-15" },
      { id: 2, nome: "Camila Dias", periodo: "2024/2025", dias: 30, vencimento: "2026-01-20" },
      { id: 3, nome: "Marcos Silva", periodo: "2024/2025", dias: 20, vencimento: "2026-01-25" }
    ];

    document.addEventListener("DOMContentLoaded", () => {
      if (!Auth.requireAuth()) return;
      initUI();
      initSidebar();
      initTabs();
      render();
    });

    function initUI() {
      const user = Auth.getCurrentUser();
      document.getElementById("userName").textContent = user?.email?.split("@")[0] || "Usuário";
      document.getElementById("userAvatar").textContent = (user?.email || "U")[0].toUpperCase();
      document.getElementById("userMenuButton").onclick = () => document.getElementById("userDropdown").classList.toggle("active");
      document.getElementById("logoutButton").onclick = (e) => { e.preventDefault(); Auth.logout(); };
    }

    function initSidebar() {
      const sidebar = document.getElementById('sidebar');
      const mobileBtn = document.getElementById('mobileMenuBtn');

      mobileBtn?.addEventListener('click', () => {
        sidebar.classList.toggle('mobile-open');
      });

      document.addEventListener('click', (e) => {
        if (window.innerWidth <= 768) {
          if (!e.target.closest('.sidebar') && !e.target.closest('.mobile-menu-btn')) {
            sidebar.classList.remove('mobile-open');
          }
        }
      });
    }

    function initTabs() {
      document.querySelectorAll('.tabs .tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tabs .tab-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          document.querySelector(`[data-tab-content="${btn.dataset.tab}"]`).classList.add('active');
        });
      });
    }

    function render() {
      document.getElementById("solicitacoesBody").innerHTML = solicitacoes.map(s => `
        <tr>
          <td><div class="cell-avatar"><div class="avatar">${s.nome.split(' ').map(n=>n[0]).slice(0,2).join('')}</div><span>${s.nome}</span></div></td>
          <td>${formatDate(s.inicio)} a ${formatDate(s.fim)}</td>
          <td class="hide-mobile">${s.dias} dias</td>
          <td class="hide-mobile">${formatDate(s.solicitado)}</td>
          <td><span class="badge ${s.status === 'APROVADO' ? 'badge-success' : 'badge-warning'}">${s.status === 'APROVADO' ? 'Aprovado' : 'Pendente'}</span></td>
          <td>
            <div class="cell-actions">
              ${s.status === 'PENDENTE' ? `
                <button class="btn-icon" onclick="approve(${s.id})" title="Aprovar" style="color: var(--success-green);"><img src="/front/public/assets/check (1).png" alt="icone_aprovar"></button>
                <button class="btn-icon" onclick="reject(${s.id})" title="Rejeitar" style="color: var(--error-red);"><img src="/front/public/assets/x.png" alt="icone_rejeitar"></button>
              ` : `<button class="btn-icon view" onclick="viewDetails(${s.id})"><img src="/front/public/assets/eye.png" alt="icone_ver_detalhes"></button>`}
            </div>
          </td>
        </tr>
      `).join('');

      document.getElementById("programadasBody").innerHTML = programadas.map(p => `
        <tr>
          <td><div class="cell-avatar"><div class="avatar">${p.nome.split(' ').map(n=>n[0]).slice(0,2).join('')}</div><span>${p.nome}</span></div></td>
          <td>${formatDate(p.inicio)}</td>
          <td>${formatDate(p.fim)}</td>
          <td class="hide-mobile">${p.dias} dias</td>
          <td><span class="badge ${p.status === 'EM_FERIAS' ? 'badge-info' : 'badge-success'}">${p.status === 'EM_FERIAS' ? 'Em Férias' : 'Agendado'}</span></td>
        </tr>
      `).join('');

      document.getElementById("vencidasBody").innerHTML = vencidas.map(v => `
        <tr>
          <td><div class="cell-avatar"><div class="avatar">${v.nome.split(' ').map(n=>n[0]).slice(0,2).join('')}</div><span>${v.nome}</span></div></td>
          <td>${v.periodo}</td>
          <td>${v.dias} dias</td>
          <td><span class="badge badge-danger">${formatDate(v.vencimento)}</span></td>
          <td><button class="btn btn-primary btn-sm" onclick="scheduleVacation(${v.id})">Agendar</button></td>
        </tr>
      `).join('');
    }

    function openModal() { document.getElementById("form").reset(); Modal.open('modal'); }
    function save() { Toast.success('Solicitação enviada com sucesso!'); Modal.close('modal'); }
    function approve(id) { Confirm.show('Aprovar esta solicitação de férias?', () => { Toast.success('Férias aprovadas!'); }); }
    function reject(id) { Confirm.show('Rejeitar esta solicitação de férias?', () => { Toast.warning('Férias rejeitadas'); }); }
    function viewDetails(id) { Toast.info('Detalhes da solicitação'); }
    function scheduleVacation(id) { openModal(); }
    
    function showCalendar() {
      const months = ['Janeiro', 'Fevereiro', 'Março', 'Abril'];
      document.getElementById("calendarView").innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-4);">
          ${months.map((m, i) => `
            <div style="background: var(--gray-50); padding: var(--spacing-4); border-radius: var(--radius-md);">
              <h4 style="margin-bottom: var(--spacing-3);">${m} 2026</h4>
              <div style="display: flex; flex-wrap: wrap; gap: 2px;">
                ${Array.from({length: 30}, (_, d) => {
                  const hasVacation = Math.random() > 0.8;
                  return `<div style="width: 24px; height: 24px; background: ${hasVacation ? 'var(--primary-dark)' : 'white'}; color: ${hasVacation ? 'white' : 'var(--gray-600)'}; display: flex; align-items: center; justify-content: center; font-size: 11px; border-radius: 3px;">${d + 1}</div>`;
                }).join('')}
              </div>
            </div>
          `).join('')}
        </div>
        <div style="margin-top: var(--spacing-4); display: flex; gap: var(--spacing-4); font-size: var(--font-size-sm);">
          <span><span style="display: inline-block; width: 16px; height: 16px; background: var(--primary-dark); border-radius: 3px; vertical-align: middle;"></span> Férias programadas</span>
        </div>
      `;
      Modal.open('calendarModal');
    }

    function formatDate(d) { return new Date(d + 'T00:00:00').toLocaleDateString('pt-BR'); }
  </script>
</body>
</html>
